{% extends "base.html" %}
{% block title %}{{ project.name }}{% endblock %}
{% block content %}

<div class="container mt-4">

  <div class="card shadow-sm mb-4">
      <div class="card-body">
    <div class="d-flex justify-content-between align-items-start mb-3">
      <div>
        <h1 class="card-title display-6">{{ project.name }}</h1>
        <p><strong>Project Number:</strong> {{ project.project_number }}</p>
        <p><strong>Address:</strong> {{ project.address }}</p>
        <p><strong>Start Date:</strong> {{ project.start_date }}</p>
        <p><strong>Stage:</strong> {{ project.stage }}</p>
      </div>
      <div class="text-end d-flex flex-column gap-2">
        <a href="{% url 'edit_project' project.pk %}" class="btn btn-outline-primary btn-sm">✏️ Edit Project</a>
        <form method="post" action="{% url 'delete_project' project.pk %}" onsubmit="return confirm('Are you sure you want to delete this project?');">
          {% csrf_token %}
          <button type="submit" class="btn btn-outline-danger btn-sm">🗑️ Delete Project</button>
        </form>
      </div>
    </div>
  </div>
</div>
    <div class="card-body">
      <h1 class="card-title display-6">{{ project.name }}</h1>
      <p><strong>Project Number:</strong> {{ project.project_number }}</p>
      <p><strong>Address:</strong> {{ project.address }}</p>
      <p><strong>Start Date:</strong> {{ project.start_date }}</p>
      <p><strong>Stage:</strong> {{ project.stage }}</p>
    </div>
  </div>

  <div class="card shadow-sm mb-4">
    <div class="card-header bg-primary text-white">
      👥 Stakeholders
    </div>
    <ul class="list-group list-group-flush">
      {% for ps in stakeholders %}
        <li class="list-group-item">
          {{ ps.stakeholder.get_role_display }}: {{ ps.stakeholder.name }}
          {% if ps.role_description %}<br><small class="text-muted">— {{ ps.role_description }}</small>{% endif %}
        </li>
      {% empty %}
        <li class="list-group-item text-muted">No stakeholders assigned.</li>
      {% endfor %}
    </ul>
    <div class="card-body d-flex gap-2">
      <a href="{% url 'assign_stakeholder' project.pk %}" class="btn btn-outline-primary btn-sm">+ Assign Stakeholder</a>
      <a href="{% url 'create_stakeholder' %}" class="btn btn-outline-secondary btn-sm">+ New Stakeholder</a>
    </div>
  </div>

  <div class="card shadow-sm mb-4">
    <div class="card-header bg-success text-white">
      ✅ Checklist
    </div>
    <ul class="list-group list-group-flush">
      {% for item in checklist %}
        <li class="list-group-item d-flex justify-content-between align-items-start">
          <div>
            <strong>{{ item.item }}</strong>
            {% if item.notes %}<br><small class="text-muted">{{ item.notes }}</small>{% endif %}
          </div>
          <span class="badge bg-secondary">{{ item.status }}</span>
        </li>
      {% empty %}
        <li class="list-group-item text-muted">No checklist items.</li>
      {% endfor %}
    </ul>
    <div class="card-body">
      <a href="{% url 'add_checklist_item' project.pk %}" class="btn btn-outline-success btn-sm">+ Add Checklist Item</a>
    </div>
  </div>

<div class="card shadow-sm mb-4">
    <div class="card-header bg-info text-white">
      📁 Documents
    </div>
    <ul class="list-group list-group-flush">
      {% for doc in documents %}
        <li class="list-group-item d-flex justify-content-between align-items-center">
          <div>
            <strong>{{ doc.doc_type }}</strong>: <a href="{{ doc.file.url }}" target="_blank">{{ doc.filename }}</a>
          </div>
          <small class="text-muted">{{ doc.uploaded_at|date:"Y-m-d" }}</small>
        </li>
      {% empty %}
        <li class="list-group-item text-muted">No documents uploaded.</li>
      {% endfor %}
    </ul>
    <div class="card-body d-flex gap-2">
      <a href="{% url 'upload_document' project.pk %}" class="btn btn-outline-info btn-sm">+ Upload Document</a>
      <a href="{% url 'export_project_pdf' project.pk %}" class="btn btn-outline-dark btn-sm">📄 Export as PDF</a>
    </div>
  </div>

  <div class="text-center mt-3">
    <a href="{% url 'project_list' %}" class="btn btn-link">← Back to Project List</a>
  </div>

</div>

{% endblock %}